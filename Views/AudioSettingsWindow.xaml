<Window x:Class="BootLauncherLite.Views.AudioSettingsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Audio Settings"
        Height="360"
        Width="647"
        WindowStartupLocation="CenterOwner"
        Background="{DynamicResource CardBackgroundBrush}"
        Foreground="{DynamicResource GroupBoxForegroundBrush}"
        WindowStyle="SingleBorderWindow"
        ResizeMode="CanResize">

    <Window.Resources>
        <!-- These brushes can be overridden from ApplyTheme in AudioSettingsWindow.xaml.cs -->
        <SolidColorBrush x:Key="ComboBgBrush"    Color="#FF1F2937"/>
        <!-- dark grey -->
        <SolidColorBrush x:Key="ComboFgBrush"    Color="#FFFFFFFF"/>
        <!-- white text -->
        <SolidColorBrush x:Key="ComboHoverBrush" Color="#FF374151"/>

        <!-- GroupBox -->
        <SolidColorBrush x:Key="GroupBoxBackgroundBrush" Color="#1F2937"/>
        <SolidColorBrush x:Key="GroupBoxBorderBrush"      Color="#374151"/>
        <SolidColorBrush x:Key="GroupBoxForegroundBrush"  Color="White"/>

        <!-- Controls (NEW: to match main window theme) -->
        <SolidColorBrush x:Key="ControlBackgroundBrush"   Color="#303030" />
        <SolidColorBrush x:Key="ControlForegroundBrush"   Color="#F5F5F5" />

        <!-- Buttons -->
        <SolidColorBrush x:Key="ButtonBackgroundBrush"        Color="#1F2937"/>
        <SolidColorBrush x:Key="ButtonBorderBrush"            Color="#374151"/>
        <!-- border / general fg brush -->
        <SolidColorBrush x:Key="ButtonForegroundBrush"        Color="White"/>
        <!-- separate text color (NEW) -->
        <SolidColorBrush x:Key="ButtonTextBrush"              Color="#F5F5F5"/>

        <SolidColorBrush x:Key="ButtonHoverBackgroundBrush"   Color="#2B5EBF"/>
        <SolidColorBrush x:Key="ButtonHoverBorderBrush"       Color="#60A5FA"/>
        <SolidColorBrush x:Key="ButtonPressedBackgroundBrush" Color="#1E40AF"/>

        <!-- DataGrid theme brushes -->
        <SolidColorBrush x:Key="DataGridBackgroundBrush" Color="#111827"/>
        <SolidColorBrush x:Key="DataGridRowBrush"        Color="#1F2937"/>
        <SolidColorBrush x:Key="DataGridAltRowBrush"     Color="#111827"/>
        <SolidColorBrush x:Key="DataGridGridLinesBrush"  Color="#374151"/>
        <SolidColorBrush x:Key="DataGridHoverBrush"      Color="#2B5EBF"/>
        <SolidColorBrush x:Key="DataGridSelectedBrush"   Color="#2B3440"/>
        <SolidColorBrush x:Key="DataGridForegroundBrush" Color="White"/>

        <!-- NEW: header-only brushes -->
        <SolidColorBrush x:Key="DataGridHeaderBackgroundBrush" Color="#111827"/>
        <SolidColorBrush x:Key="DataGridHeaderForegroundBrush" Color="White"/>

        <!-- Dark themed ComboBox with working dropdown -->
        <Style x:Key="ThemedComboBox" TargetType="ComboBox">
            <Setter Property="Foreground" Value="{DynamicResource ComboFgBrush}" />
            <Setter Property="Background" Value="{DynamicResource ComboBgBrush}" />
            <Setter Property="BorderBrush" Value="{DynamicResource ComboBgBrush}" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="Padding" Value="4,2" />
            <Setter Property="SnapsToDevicePixels" Value="True" />
            <Setter Property="ScrollViewer.HorizontalScrollBarVisibility" Value="Auto" />
            <Setter Property="ScrollViewer.VerticalScrollBarVisibility" Value="Auto" />

            <!-- Template handles closed box + arrow + popup -->
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ComboBox">
                        <Grid>
                            <!-- ToggleButton controls IsDropDownOpen -->
                            <ToggleButton x:Name="ToggleButton"
                                          Background="{DynamicResource ComboBgBrush}"
                                          BorderBrush="{DynamicResource ComboBgBrush}"
                                          BorderThickness="1"
                                          Focusable="False"
                                          ClickMode="Press"
                                          IsChecked="{Binding IsDropDownOpen, Mode=TwoWay,
                                                              RelativeSource={RelativeSource TemplatedParent}}">
                                <Grid>
                                    <Border Background="{DynamicResource ComboBgBrush}"
                                            CornerRadius="2"/>
                                    <!-- Selected item text -->
                                    <ContentPresenter
                                        Margin="6,3,25,3"
                                        HorizontalAlignment="Left"
                                        VerticalAlignment="Center"
                                        Content="{TemplateBinding SelectionBoxItem}"
                                        ContentTemplate="{TemplateBinding SelectionBoxItemTemplate}"
                                        ContentTemplateSelector="{TemplateBinding ItemTemplateSelector}" />
                                    <!-- Arrow -->
                                    <Path x:Name="Arrow"
                                          VerticalAlignment="Center"
                                          HorizontalAlignment="Right"
                                          Margin="0,0,8,0"
                                          Fill="{DynamicResource ComboFgBrush}"
                                          Data="M 0 0 L 4 4 L 8 0 Z" />
                                </Grid>
                            </ToggleButton>

                            <!-- Dropdown popup -->
                            <Popup x:Name="Popup"
                                   Placement="Bottom"
                                   AllowsTransparency="True"
                                   Focusable="False"
                                   PopupAnimation="Slide"
                                   IsOpen="{TemplateBinding IsDropDownOpen}"
                                   PlacementTarget="{Binding ElementName=ToggleButton}">
                                <Border Background="{DynamicResource ComboBgBrush}"
                                        BorderBrush="{DynamicResource ComboBgBrush}"
                                        BorderThickness="1">
                                    <ScrollViewer>
                                        <StackPanel IsItemsHost="True" />
                                    </ScrollViewer>
                                </Border>
                            </Popup>
                        </Grid>

                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="ToggleButton"
                                        Property="Background"
                                        Value="{DynamicResource ComboHoverBrush}" />
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Opacity" Value="0.6" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>

            <!-- Dropdown items -->
            <Setter Property="ItemContainerStyle">
                <Setter.Value>
                    <Style TargetType="ComboBoxItem">
                        <Setter Property="Background" Value="{DynamicResource ComboBgBrush}" />
                        <Setter Property="Foreground" Value="{DynamicResource ComboFgBrush}" />
                        <Setter Property="Padding" Value="4,2" />
                        <Style.Triggers>
                            <Trigger Property="IsHighlighted" Value="True">
                                <Setter Property="Background"
                                        Value="{DynamicResource ComboHoverBrush}" />
                            </Trigger>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter Property="Background"
                                        Value="{DynamicResource ComboHoverBrush}" />
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </Setter.Value>
            </Setter>
        </Style>

        <Style TargetType="Button">
            <!-- base brushes coming from theme -->
            <Setter Property="Background"      Value="{DynamicResource ButtonBackgroundBrush}"/>
            <Setter Property="BorderBrush"     Value="{DynamicResource ButtonBorderBrush}"/>
            <Setter Property="Foreground"      Value="{DynamicResource ButtonForegroundBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding"         Value="6,3"/>
            <Setter Property="Cursor"          Value="Hand"/>

            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}"
                BorderBrush="{TemplateBinding BorderBrush}"
                BorderThickness="{TemplateBinding BorderThickness}"
                CornerRadius="6"
                Padding="{TemplateBinding Padding}">
                            <!-- TextBlock so we fully control text color -->
                            <TextBlock Style="{x:Null}"
                       Text="{TemplateBinding Content}"
                       HorizontalAlignment="Center"
                       VerticalAlignment="Center"
                       Foreground="{DynamicResource ButtonForegroundBrush}"
                       TextWrapping="NoWrap"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>

            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background"  Value="{DynamicResource ButtonHoverBackgroundBrush}"/>
                    <Setter Property="BorderBrush" Value="{DynamicResource ButtonHoverBorderBrush}"/>
                    <Setter Property="Foreground"  Value="{DynamicResource ButtonForegroundBrush}"/>
                </Trigger>
                <Trigger Property="IsPressed" Value="True">
                    <Setter Property="Background" Value="{DynamicResource ButtonPressedBackgroundBrush}"/>
                </Trigger>
                <Trigger Property="IsEnabled" Value="False">
                    <Setter Property="Opacity" Value="0.5"/>
                </Trigger>
            </Style.Triggers>
        </Style>


        <!-- Add GroupBox + implicit Button style so this window follows the same "system" as LogWindow -->
        <Style TargetType="GroupBox" x:Key="RoundedGroupBox">
            <Setter Property="Foreground" Value="{DynamicResource GroupBoxForegroundBrush}"/>
            <Setter Property="Background" Value="{DynamicResource GroupBoxBackgroundBrush}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource GroupBoxBorderBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="8"/>
            <Setter Property="Margin" Value="0,0,0,10"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="GroupBox">
                        <Grid>
                            <Border Background="{TemplateBinding Background}"
                                    BorderBrush="{TemplateBinding BorderBrush}"
                                    BorderThickness="{TemplateBinding BorderThickness}"
                                    CornerRadius="8"
                                    Padding="{TemplateBinding Padding}">
                                <ContentPresenter Margin="0,10,0,0" />
                            </Border>
                            <Border Background="#111827"
                                    HorizontalAlignment="Left"
                                    VerticalAlignment="Top"
                                    Margin="12,-10,0,0"
                                    Padding="6,0"
                                    CornerRadius="2"
                                    IsHitTestVisible="False">
                                <ContentPresenter ContentSource="Header"
                                                  RecognizesAccessKey="True"
                                                  SnapsToDevicePixels="True" />
                            </Border>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- DataGrid column header style with explicit template, fully theme-driven -->
        <Style x:Key="CustomDataGridColumnHeaderStyle"
               TargetType="DataGridColumnHeader">

            <!-- base brushes (these are the ones your theme code updates) -->
            <Setter Property="Background"
                    Value="{DynamicResource DataGridHeaderBackgroundBrush}" />
            <Setter Property="Foreground"
                    Value="{DynamicResource DataGridHeaderForegroundBrush}" />
            <Setter Property="BorderBrush"
                    Value="{DynamicResource DataGridGridLinesBrush}" />
            <Setter Property="BorderThickness"
                    Value="0,0,0,1" />
            <Setter Property="Padding"
                    Value="8,6" />
            <Setter Property="HorizontalContentAlignment"
                    Value="Left" />
            <Setter Property="FontWeight"
                    Value="Bold" />
            <Setter Property="Height"
                    Value="34" />

            <!-- our own template so Foreground / Background actually apply -->
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="DataGridColumnHeader">
                        <Border Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}">
                            <TextBlock Text="{TemplateBinding Content}"
                                       Margin="{TemplateBinding Padding}"
                                       VerticalAlignment="Center"
                                       HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                       FontWeight="{TemplateBinding FontWeight}"
                                       Foreground="{TemplateBinding Foreground}" />
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>

            <!-- hover / pressed also use your theme brushes -->
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background"
                            Value="{DynamicResource DataGridHoverBrush}" />
                    <Setter Property="Foreground"
                            Value="{DynamicResource DataGridHeaderForegroundBrush}" />
                </Trigger>
                <Trigger Property="IsPressed" Value="True">
                    <Setter Property="Background"
                            Value="{DynamicResource DataGridSelectedBrush}" />
                    <Setter Property="Foreground"
                            Value="{DynamicResource DataGridHeaderForegroundBrush}" />
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Shared TextBox theme (NEW) -->
        <Style TargetType="TextBox">
            <Setter Property="Background"      Value="{DynamicResource DataGridRowBrush}" />
            <Setter Property="Foreground"      Value="{DynamicResource DataGridForegroundBrush}" />
            <Setter Property="BorderBrush"     Value="{DynamicResource GroupBoxBorderBrush}" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="FocusVisualStyle" Value="{x:Null}" />
        </Style>

        <!-- Flag-style checkbox, for future reuse if needed (NEW) -->
        <Style x:Key="FlagCheckBoxStyle" TargetType="CheckBox">
            <Setter Property="Background" Value="{DynamicResource ControlBackgroundBrush}" />
            <Setter Property="Padding"    Value="4,2" />
            <Setter Property="Margin"     Value="0,0,12,0" />
        </Style>

        <Style x:Key="ThemeLabel" TargetType="TextBlock">
            <Setter Property="Foreground" Value="{DynamicResource GroupBoxForegroundBrush}" />
        </Style>

    </Window.Resources>

    <!-- rest of your Grid layout stays exactly as you posted -->
    <Grid Margin="12">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <!-- Playback label -->
            <RowDefinition Height="Auto" />
            <!-- Playback row -->
            <RowDefinition Height="Auto" />
            <!-- Capture label -->
            <RowDefinition Height="Auto" />
            <!-- Capture row -->
            <RowDefinition Height="*" />
            <!-- Info + fallback -->
            <RowDefinition Height="Auto" />
            <!-- Close button -->
        </Grid.RowDefinitions>

        <!-- Playback -->
        <TextBlock Grid.Row="0"
                   Text="Playback (Speakers / Headphones):"
                   FontWeight="Bold" Style="{StaticResource ThemeLabel}" />

        <StackPanel Grid.Row="1"
                    Orientation="Horizontal"
                    Margin="0,4,0,12">
            <ComboBox x:Name="PlaybackComboBox"
                      Width="341"
                      DisplayMemberPath="Name"
                      SelectedValuePath="Id"
                      Style="{StaticResource ThemedComboBox}" />
            <Button Content="Set as default"
                    Width="244"
                    Margin="10,0,0,0"
                    
                    Click="SetPlaybackDefaultButton_Click" />
        </StackPanel>

        <!-- Capture -->
        <TextBlock Grid.Row="2"
                   Text="Recording (Microphones):"
                   FontWeight="Bold" Style="{StaticResource ThemeLabel}" />

        <StackPanel Grid.Row="3"
                    Orientation="Horizontal"
                    Margin="0,4,0,12">
            <ComboBox x:Name="CaptureComboBox"
                      Width="343"
                      DisplayMemberPath="Name"
                      SelectedValuePath="Id"
                      Style="{StaticResource ThemedComboBox}" />
            <Button Content="Set as default"
                    Width="243"
                    Margin="10,0,0,0"
                    
                    Click="SetCaptureDefaultButton_Click" />
        </StackPanel>

        <!-- Info + fallback area -->
        <StackPanel Grid.Row="4"
                    Margin="0,4,0,0">
            <TextBlock x:Name="InfoTextBlock"
                       Style="{StaticResource ThemeLabel}"
                       Text=""
                       Visibility="Collapsed"
                       TextWrapping="Wrap"
                       Margin="0,0,0,8"
                       Opacity="0.9" />
            <Button x:Name="OpenSystemSoundButton"
                    Content="Open Windows sound settings"
                    Width="220"
                    Visibility="Collapsed"
                    
                    Click="OpenSystemSoundButton_Click" />
        </StackPanel>

        <!-- Close button -->
        <StackPanel Grid.Row="5"
                    Orientation="Horizontal"
                    HorizontalAlignment="Right"
                    Margin="0,16,0,0">
            <Button Content="Close"
                    Width="80"
                    IsCancel="True"
                    
                    Click="CloseButton_Click" />
        </StackPanel>
    </Grid>
</Window>

