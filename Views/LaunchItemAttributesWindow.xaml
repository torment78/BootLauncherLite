<Window x:Class="BootLauncherLite.Views.LaunchItemAttributesWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Launch Item Attributes"
        Height="379"
        Width="540"
        WindowStartupLocation="CenterOwner"
        Background="{DynamicResource CardBackgroundBrush}"
        Foreground="{DynamicResource GroupBoxForegroundBrush}"
        ResizeMode="NoResize">
    <Window.Resources>
        <!-- These brushes can be overridden from ApplyTheme in AudioSettingsWindow.xaml.cs -->
        <SolidColorBrush x:Key="ComboBgBrush"    Color="#FF1F2937"/>
        <!-- dark grey -->
        <SolidColorBrush x:Key="ComboFgBrush"    Color="#FFFFFFFF"/>
        <!-- white text -->
        <SolidColorBrush x:Key="ComboHoverBrush" Color="#FF374151"/>
        <SolidColorBrush x:Key="ThemeTextBrush"                 Color="#E5E7EB"/>

        <!-- GroupBox -->
        <SolidColorBrush x:Key="GroupBoxBackgroundBrush" Color="#1F2937"/>
        <SolidColorBrush x:Key="GroupBoxBorderBrush"      Color="#374151"/>
        <SolidColorBrush x:Key="GroupBoxForegroundBrush"  Color="White"/>

        <!-- Buttons -->
        <SolidColorBrush x:Key="ButtonBackgroundBrush"        Color="#1F2937"/>
        <SolidColorBrush x:Key="ButtonBorderBrush"            Color="#374151"/>
        <SolidColorBrush x:Key="ButtonForegroundBrush"        Color="White"/>

        <SolidColorBrush x:Key="ButtonHoverBackgroundBrush"   Color="#2B5EBF"/>
        <SolidColorBrush x:Key="ButtonHoverBorderBrush"       Color="#60A5FA"/>
        <SolidColorBrush x:Key="ButtonPressedBackgroundBrush" Color="#1E40AF"/>

        <!-- DataGrid theme brushes -->
        <!-- DataGrid theme brushes -->
        <SolidColorBrush x:Key="DataGridBackgroundBrush" Color="#111827"/>
        <SolidColorBrush x:Key="DataGridRowBrush"        Color="#1F2937"/>
        <SolidColorBrush x:Key="DataGridAltRowBrush"     Color="#111827"/>
        <SolidColorBrush x:Key="DataGridGridLinesBrush"  Color="#374151"/>
        <SolidColorBrush x:Key="DataGridHoverBrush"      Color="#2B5EBF"/>
        <SolidColorBrush x:Key="DataGridSelectedBrush"   Color="#2B3440"/>
        <SolidColorBrush x:Key="DataGridForegroundBrush" Color="White"/>

        <!-- NEW: header-only brushes -->
        <SolidColorBrush x:Key="DataGridHeaderBackgroundBrush" Color="#111827"/>
        <SolidColorBrush x:Key="DataGridHeaderForegroundBrush" Color="White"/>


        <!-- Dark themed ComboBox with working dropdown -->
        <Style x:Key="ThemedComboBox" TargetType="ComboBox">
            <Setter Property="Foreground" Value="{DynamicResource ComboFgBrush}" />
            <Setter Property="Background" Value="{DynamicResource ComboBgBrush}" />
            <Setter Property="BorderBrush" Value="{DynamicResource ComboBgBrush}" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="Padding" Value="4,2" />
            <Setter Property="SnapsToDevicePixels" Value="True" />
            <Setter Property="ScrollViewer.HorizontalScrollBarVisibility" Value="Auto" />
            <Setter Property="ScrollViewer.VerticalScrollBarVisibility" Value="Auto" />

            <!-- Template handles closed box + arrow + popup -->
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ComboBox">
                        <Grid>
                            <!-- ToggleButton controls IsDropDownOpen -->
                            <ToggleButton x:Name="ToggleButton"
                                      Background="{DynamicResource ComboBgBrush}"
                                      BorderBrush="{DynamicResource ComboBgBrush}"
                                      BorderThickness="1"
                                      Focusable="False"
                                      ClickMode="Press"
                                      IsChecked="{Binding IsDropDownOpen, Mode=TwoWay,
                                                          RelativeSource={RelativeSource TemplatedParent}}">
                                <Grid>
                                    <Border Background="{DynamicResource ComboBgBrush}"
                                        CornerRadius="2"/>
                                    <!-- Selected item text -->
                                    <ContentPresenter
                                    Margin="6,3,25,3"
                                    HorizontalAlignment="Left"
                                    VerticalAlignment="Center"
                                    Content="{TemplateBinding SelectionBoxItem}"
                                    ContentTemplate="{TemplateBinding SelectionBoxItemTemplate}"
                                    ContentTemplateSelector="{TemplateBinding ItemTemplateSelector}" />
                                    <!-- Arrow -->
                                    <Path x:Name="Arrow"
                                      VerticalAlignment="Center"
                                      HorizontalAlignment="Right"
                                      Margin="0,0,8,0"
                                      Fill="{DynamicResource ComboFgBrush}"
                                      Data="M 0 0 L 4 4 L 8 0 Z" />
                                </Grid>
                            </ToggleButton>

                            <!-- Dropdown popup -->
                            <Popup x:Name="Popup"
                               Placement="Bottom"
                               AllowsTransparency="True"
                               Focusable="False"
                               PopupAnimation="Slide"
                               IsOpen="{TemplateBinding IsDropDownOpen}"
                               PlacementTarget="{Binding ElementName=ToggleButton}">
                                <Border Background="{DynamicResource ComboBgBrush}"
                                    BorderBrush="{DynamicResource ComboBgBrush}"
                                    BorderThickness="1">
                                    <ScrollViewer>
                                        <StackPanel IsItemsHost="True" />
                                    </ScrollViewer>
                                </Border>
                            </Popup>
                        </Grid>

                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="ToggleButton"
                                    Property="Background"
                                    Value="{DynamicResource ComboHoverBrush}" />
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Opacity" Value="0.6" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>

            <!-- Dropdown items -->
            <Setter Property="ItemContainerStyle">
                <Setter.Value>
                    <Style TargetType="ComboBoxItem">
                        <Setter Property="Background" Value="{DynamicResource ComboBgBrush}" />
                        <Setter Property="Foreground" Value="{DynamicResource ComboFgBrush}" />
                        <Setter Property="Padding" Value="4,2" />
                        <Style.Triggers>
                            <Trigger Property="IsHighlighted" Value="True">
                                <Setter Property="Background"
                                    Value="{DynamicResource ComboHoverBrush}" />
                            </Trigger>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter Property="Background"
                                    Value="{DynamicResource ComboHoverBrush}" />
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </Setter.Value>
            </Setter>
        </Style>

        <Style TargetType="Button">
            <!-- base brushes coming from theme -->
            <Setter Property="Background"      Value="{DynamicResource ButtonBackgroundBrush}"/>
            <Setter Property="BorderBrush"     Value="{DynamicResource ButtonBorderBrush}"/>
            <Setter Property="Foreground"      Value="{DynamicResource ButtonForegroundBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding"         Value="6,3"/>
            <Setter Property="Cursor"          Value="Hand"/>

            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}"
                BorderBrush="{TemplateBinding BorderBrush}"
                BorderThickness="{TemplateBinding BorderThickness}"
                CornerRadius="6"
                Padding="{TemplateBinding Padding}">
                            <!-- TextBlock so we fully control text color -->
                            <TextBlock Style="{x:Null}"
                       Text="{TemplateBinding Content}"
                       HorizontalAlignment="Center"
                       VerticalAlignment="Center"
                       Foreground="{DynamicResource ButtonForegroundBrush}"
                       TextWrapping="NoWrap"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>

            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background"  Value="{DynamicResource ButtonHoverBackgroundBrush}"/>
                    <Setter Property="BorderBrush" Value="{DynamicResource ButtonHoverBorderBrush}"/>
                    <Setter Property="Foreground"  Value="{DynamicResource ButtonForegroundBrush}"/>
                </Trigger>
                <Trigger Property="IsPressed" Value="True">
                    <Setter Property="Background" Value="{DynamicResource ButtonPressedBackgroundBrush}"/>
                </Trigger>
                <Trigger Property="IsEnabled" Value="False">
                    <Setter Property="Opacity" Value="0.5"/>
                </Trigger>
            </Style.Triggers>
        </Style>


        <!-- Add GroupBox + implicit Button style so this window follows the same "system" as LogWindow -->

        <Style TargetType="GroupBox" x:Key="RoundedGroupBox">
            <Setter Property="Foreground" Value="{DynamicResource GroupBoxForegroundBrush}"/>
            <Setter Property="Background" Value="{DynamicResource GroupBoxBackgroundBrush}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource GroupBoxBorderBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="8"/>
            <Setter Property="Margin" Value="0,0,0,10"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="GroupBox">
                        <Grid>
                            <Border Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="8"
                                Padding="{TemplateBinding Padding}">
                                <ContentPresenter Margin="0,10,0,0" />
                            </Border>
                            <Border Background="#111827"
                                HorizontalAlignment="Left"
                                VerticalAlignment="Top"
                                Margin="12,-10,0,0"
                                Padding="6,0"
                                CornerRadius="2"
                                IsHitTestVisible="False">
                                <ContentPresenter ContentSource="Header"
                                              RecognizesAccessKey="True"
                                              SnapsToDevicePixels="True" />
                            </Border>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="ThemeLabel" TargetType="TextBlock">
            <Setter Property="Foreground" Value="{DynamicResource GroupBoxForegroundBrush}" />
        </Style>
    </Window.Resources>
    <Grid Margin="12,12,12,10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <!-- item info -->
            <RowDefinition Height="Auto"/>
            <!-- args -->
            <RowDefinition Height="Auto"/>
            <!-- working dir -->
            <RowDefinition Height="Auto"/>
            <!-- kill options -->
            <RowDefinition Height="*"/>
            <!-- info -->
            <RowDefinition Height="Auto"/>
            <!-- buttons -->
        </Grid.RowDefinitions>

        <!-- Item info -->
        <StackPanel Grid.Row="0" Margin="0,0,0,8">
            <TextBlock Text="Launch item:"
                       FontWeight="Bold" Style="{StaticResource ThemeLabel}" />
            <TextBlock x:Name="DisplayNameTextBlock"
                       Margin="0,2,0,0"
                       Opacity="0.9"/>
            <TextBlock x:Name="PathTextBlock"
                       Margin="0,2,0,0"
                       FontSize="11"
                       Opacity="0.7"
                       TextTrimming="CharacterEllipsis"/>
        </StackPanel>

        <!-- Arguments -->
        <StackPanel Grid.Row="1" Margin="0,4,0,8">
            <TextBlock Text="Arguments:"
                       Margin="0,0,0,2" Style="{StaticResource ThemeLabel}" />
            <TextBox x:Name="ArgumentsTextBox"
                    Background="{DynamicResource DataGridRowBrush}"
                     Height="24"/>
            <TextBlock Margin="0,2,0,0"
                       FontSize="11"
                       Opacity="0.7"
                       Text="Example: &quot;C:\Users\torme\Music\epidemic\ES_Final Frontier - Hampus Naeselius.mp3&quot;"
                       Style="{StaticResource ThemeLabel}" />
        </StackPanel>

        <!-- Working dir -->
        <StackPanel Grid.Row="2" Margin="0,4,0,8">
            <TextBlock Text="Working directory (optional):"
                       Margin="0,0,0,2" Style="{StaticResource ThemeLabel}" />
            <DockPanel>
                <TextBox x:Name="WorkingDirTextBox"
                         Background="{DynamicResource DataGridRowBrush}"
                         Height="24"
                         Margin="0,0,4,0" Width="406"/>
                <Button Content="Browse..."
                        Width="80"
                        Click="BrowseWorkingDir_Click"/>
            </DockPanel>
        </StackPanel>

        <!-- Kill options + admin flag -->
        <StackPanel Grid.Row="3" Margin="0,4,0,8">
            <CheckBox x:Name="KillInsteadCheckBox"
                      Margin="0,0,0,0"                      
                      HorizontalAlignment="left"                     
                      Width="239"/>
            <TextBlock Text="Kill process instead of launching"
                           Style="{StaticResource ThemeLabel}" 
                       Width="176"   Margin="15,-16,300,0"/>
            <!-- NEW: per-item admin flag -->
            <CheckBox x:Name="RunAsAdminCheckBox"
                      Margin="0,-15,0,0"
                      HorizontalAlignment="Right"                   
                      Width="209">
                <TextBlock Text="Run  as administrator (UAC)"
                           Style="{StaticResource ThemeLabel}" />
            </CheckBox>
            <StackPanel Orientation="Horizontal"
                Margin="0,4,0,0" Width="294"           
                HorizontalAlignment="left">
                <TextBlock Text="Process name to kill:"
                   VerticalAlignment="Center" Style="{StaticResource ThemeLabel}" />
                <TextBox x:Name="KillProcessNameTextBox"                       
                 Background="{DynamicResource DataGridRowBrush}"
                 Width="180"
                 Margin="8,0,0,0"
                 VerticalAlignment="Center"  />
            </StackPanel>
            <StackPanel Orientation="Horizontal" Margin="300,-18,0,0" Width="193">
                <TextBlock Text="Minimize wait (sec):"
               Width="127"
               VerticalAlignment="Center" Style="{StaticResource ThemeLabel}" 
               Margin="0,0,4,0"/>
                <TextBox x:Name="MinimizeDelayTextBox"
             Width="60" Margin="0,0,0,0"
             HorizontalContentAlignment="Right"/>
            </StackPanel>
            <TextBlock Text="Example: vlc.exe, obs64.exe, notepad.exe"
               FontSize="11"
               Opacity="0.7"
               Margin="20,2,0,0" Style="{StaticResource ThemeLabel}" />

            
        </StackPanel>


        <!-- Info -->
        <TextBlock Grid.Row="4"
                   Text="If working directory is empty, the folder of the EXE will be used. 
If &quot;Kill process&quot; is enabled, this item will send a kill signal to that process name instead of launching anything."
                   FontSize="11"
                   Opacity="0.7"
                   TextWrapping="Wrap" Style="{StaticResource ThemeLabel}" />

        <!-- Buttons -->
        <StackPanel Grid.Row="5"
                    Orientation="Horizontal"
                    HorizontalAlignment="Right"
                    Margin="0,10,0,0">
            <Button Content="Save"
                    Width="80"
                    Margin="0,0,8,0"
                    IsDefault="True"
                    Click="SaveButton_Click"/>
            <Button Content="Cancel"
                    Width="80"
                    IsCancel="True"/>
        </StackPanel>
    </Grid>
</Window>
